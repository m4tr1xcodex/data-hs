ace.define("ace/ext/beautify",["require","exports","module","ace/token_iterator"],(function(e,t,r){"use strict";var a=e("../token_iterator").TokenIterator;function is(e,t){return e.type.lastIndexOf(t+".xml")>-1}t.singletonTags=["area","base","br","col","command","embed","hr","html","img","input","keygen","link","meta","param","source","track","wbr"],t.blockTags=["article","aside","blockquote","body","div","dl","fieldset","footer","form","head","header","html","nav","ol","p","script","section","style","table","tbody","tfoot","thead","ul"],t.beautify=function(e){for(var r,s,o,i=new a(e,0,0),n=i.getCurrentToken(),c=e.getTabString(),u=t.singletonTags,l=t.blockTags,m=!1,p=!1,f=!1,h="",y="",d="",g=0,b=0,k=0,$=0,w=0,x=0,v=0,T=0,R=0,O=!1,q=!1,C=!1,I=!1,_={0:0},j=[],B=!1,trimNext=function(){r&&r.value&&"string.regexp"!==r.type&&(r.value=r.value.replace(/^\s*/,""))},trimLine=function(){for(var e=h.length-1;0!=e&&" "===h[e];)e-=1;h=h.slice(0,e+1)},trimCode=function(){h=h.trimRight(),m=!1};null!==n;){if(T=i.getCurrentTokenRow(),i.$rowTokens,r=i.stepForward(),void 0!==n){if(y=n.value,w=0,C="style"===d||"ace/mode/css"===e.$modeId,is(n,"tag-open")?(q=!0,r&&(I=-1!==l.indexOf(r.value)),"</"===y&&(I&&!m&&R<1&&R++,C&&(R=1),w=1,I=!1)):is(n,"tag-close")?q=!1:is(n,"comment.start")?I=!0:is(n,"comment.end")&&(I=!1),q||R||"paren.rparen"!==n.type||"}"!==n.value.substr(0,1)||R++,T!==s&&(R=T,s&&(R-=s)),R){for(trimCode();R>0;R--)h+="\n";m=!0,is(n,"comment")||n.type.match(/^(comment|string)$/)||(y=y.trimLeft())}if(y){if("keyword"===n.type&&y.match(/^(if|else|elseif|for|foreach|while|switch)$/)?(j[g]=y,trimNext(),f=!0,y.match(/^(else|elseif)$/)&&h.match(/\}[\s]*$/)&&(trimCode(),p=!0)):"paren.lparen"===n.type?(trimNext(),"{"===y.substr(-1)&&(f=!0,O=!1,q||(R=1)),"{"===y.substr(0,1)&&(p=!0,"["!==h.substr(-1)&&"["===h.trimRight().substr(-1)?(trimCode(),p=!1):")"===h.trimRight().substr(-1)?trimCode():trimLine())):"paren.rparen"===n.type?(w=1,"}"===y.substr(0,1)&&("case"===j[g-1]&&w++,"{"===h.trimRight().substr(-1)?trimCode():(p=!0,C&&(R+=2))),"]"===y.substr(0,1)&&"}"!==h.substr(-1)&&"}"===h.trimRight().substr(-1)&&(p=!1,$++,trimCode()),")"===y.substr(0,1)&&"("!==h.substr(-1)&&"("===h.trimRight().substr(-1)&&(p=!1,$++,trimCode()),trimLine()):"keyword.operator"!==n.type&&"keyword"!==n.type||!y.match(/^(=|==|===|!=|!==|&&|\|\||and|or|xor|\+=|.=|>|>=|<|<=|=>)$/)?"punctuation.operator"===n.type&&";"===y?(trimCode(),trimNext(),f=!0,C&&R++):"punctuation.operator"===n.type&&y.match(/^(:|,)$/)?(trimCode(),trimNext(),y.match(/^(,)$/)&&v>0&&0===x?R++:(f=!0,m=!1)):"support.php_tag"!==n.type||"?>"!==y||m?is(n,"attribute-name")&&h.substr(-1).match(/^\s$/)?p=!0:is(n,"attribute-equals")?(trimLine(),trimNext()):is(n,"tag-close")?(trimLine(),"/>"===y&&(p=!0)):"keyword"===n.type&&y.match(/^(case|default)$/)&&B&&(w=1):(trimCode(),p=!0):(trimCode(),trimNext(),p=!0,f=!0),m&&(!n.type.match(/^(comment)$/)||y.substr(0,1).match(/^[/#]$/))&&(!n.type.match(/^(string)$/)||y.substr(0,1).match(/^['"@]$/))){if($=k,g>b)for($++,o=g;o>b;o--)_[o]=$;else g<b&&($=_[g]);for(b=g,k=$,w&&($-=w),O&&!x&&($++,O=!1),o=0;o<$;o++)h+=c}if("keyword"===n.type&&y.match(/^(case|default)$/)?!1===B&&(j[g]=y,g++,B=!0):"keyword"===n.type&&y.match(/^(break)$/)&&j[g-1]&&j[g-1].match(/^(case|default)$/)&&(g--,B=!1),"paren.lparen"===n.type&&(x+=(y.match(/\(/g)||[]).length,v+=(y.match(/\{/g)||[]).length,g+=y.length),"keyword"===n.type&&y.match(/^(if|else|elseif|for|while)$/)?(O=!0,x=0):!x&&y.trim()&&"comment"!==n.type&&(O=!1),"paren.rparen"===n.type)for(x-=(y.match(/\)/g)||[]).length,v-=(y.match(/\}/g)||[]).length,o=0;o<y.length;o++)g--,"}"===y.substr(o,1)&&"case"===j[g]&&g--;"text"==n.type&&(y=y.replace(/\s+$/," ")),p&&!m&&(trimLine(),"\n"!==h.substr(-1)&&(h+=" ")),h+=y,f&&(h+=" "),m=!1,p=!1,f=!1,(is(n,"tag-close")&&(I||-1!==l.indexOf(d))||is(n,"doctype")&&">"===y)&&(R=I&&r&&"</"===r.value?-1:1),is(n,"tag-open")&&"</"===y?g--:is(n,"tag-open")&&"<"===y&&-1===u.indexOf(r.value)?g++:is(n,"tag-name")?d=y:is(n,"tag-close")&&"/>"===y&&-1===u.indexOf(d)&&g--,s=T}}n=r}h=h.trim(),e.doc.setValue(h)},t.commands=[{name:"beautify",description:"Format selection (Beautify)",exec:function(e){t.beautify(e.session)},bindKey:"Ctrl-Shift-B"}]})),ace.require(["ace/ext/beautify"],(function(e){"object"==typeof module&&"object"==typeof exports&&module&&(module.exports=e)}));